# Drugi domaci iz MSREAL - Simulacija stoperice koristenjem Xilinx AXI Timer-a
  [Zadatak](http://www.elektronika.ftn.uns.ac.rs/mikroracunarski-sistemi-za-rad-u-realnom-vremenu/wp-content/uploads/sites/99/2018/03/Doma%C4%87i-zadatak-2-v1.pdf) Napraviti drajver za Xilinx AXI Timer na Zybo Z7 sistemu, koji simulira rad stoperice: brojanje vremena u formatu hh:mm:ss:millis:micros, uz mogucnost startovanja (start), pauziranja (stop), i resetovanja stoperice (reset). U svakom trenutku odbrojano vreme treba biti moguce dobiti citanjem iz device fajla. Tajmer treba da radi u kaskadnom modu.
## Inicijalizacija registara
  Kaskadiranje dva raspoloziva tajmera zahteva setovanje CASC bita u TCSR0 registru. Setovanjem ovog bita koriste se oba tajmera kako bi se realizovao kaskadni tajmer do vrednosti 2^64. U ovom modu registar TCSR1 se zanemaruje, i koristi se samo za setovanje LOAD1 bita za ucitavanje u TCR1. Ovakav kaskadni mod broji u dva odvojena registra i to LSB deo je TCR0 a MSB deo je TCR1. Za load tajmera 1 se koristi njegov TLR1. Za sve ostale konfiguracije se koristi TCSR0 za oba tajmera. Potrebno je setovati i ENIT0 bit.
## Funkcionalnost
  Pri start komandi poziva se funkcija za novu inicijalizaciju registara, i prima vrednost od koga treba da pocne da broji brojac. Posto se posebno loaduje za ova dva brojaca, potrebno je proslediti vrednosti oba brojaca i loadovati ih u TLR0 i TLR1, i nakratko setovati LOAD0 i LOAD1 bitove.
  Nakon stop komande, cita se trenutna vrednost brojaca iz registara TCR0 i TCR1 i smestaju se vrednosti u startAt0 i startAt1 respektivno, da bi kasnije start mogao da nastavi gde se ovde stalo. Nakon toga se brojac onemogucava resetovanjem odgovarajuceg bita.
  Reset komanda onemogucava brojac kao i stop, ali i dodatno resetuje startAt0 i startAt1 na 0, kako bi naredni start zapoceo iznova.
## Brojanje i interrupt
  Nije bilo moguce sabrati vrednosti brojaca kao `rawCountLSB + (0x100000000*rawCountMSB)` jer je sistem 32bitni, pa je to uradjeno odvojeno, kao funkcija i LSB i MSB. Zbog zaokruzivanja brojeva postoji neznatno odstupanje u sekundama/milisekundama. Interrupt se desava samo na overflow drugog brojaca, tako da unutar ISR je potrebno proveriti vrednost TCR1, i ako je maksimalna, zaustaviti i resetovati brojac. Kako se overflow drugog brojaca desava svakih 50 miliona sati, to se nece desiti u skorije vreme...
